<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>iOS Jailbreak Quick Check â€” Advanced</title>
<style>
  :root{
    --bg1:#071028; --bg2:#07122b;
    --muted:#94a3b8; --accent1:#0a84ff; --accent2:#7c3aed;
    --ok:#34c759; --bad:#ff3b30; --glass: rgba(255,255,255,0.03);
  }
  html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  body{
    background: linear-gradient(180deg,var(--bg1) 0%, var(--bg2) 60%);
    color:#e6eef8;
    display:flex;align-items:center;justify-content:center;padding:20px;
  }
  .wrap{max-width:820px;width:100%}
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:16px;padding:18px;margin-bottom:14px;
    box-shadow:0 8px 30px rgba(2,6,23,0.6);backdrop-filter: blur(6px);
  }
  h1{margin:0 0 6px;font-size:20px}
  p.lead{margin:6px 0 0;color:var(--muted);font-size:13px}
  .controls{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
  .btn {
    border:0;padding:12px 14px;border-radius:12px;font-weight:700;cursor:pointer;
    background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:white;
    box-shadow:0 6px 18px rgba(10,132,255,0.08);
  }
  .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}
  .small{font-size:12px;color:var(--muted)}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .chip{padding:6px 10px;border-radius:999px;background:var(--glass);color:var(--muted);font-size:13px}
  .output{margin-top:14px;font-size:14px;line-height:1.4;color:#dbeafe}
  .reasons{margin:8px 0 0;padding-left:18px;color:#ffdce6}
  .ok{color:var(--ok)} .warn{color:#f59e0b} .bad{color:var(--bad)}
  footer.small{margin-top:8px;color:var(--muted);font-size:12px;text-align:center}
  code{background:rgba(255,255,255,0.03);padding:2px 6px;border-radius:6px;font-size:12px}
  .schemeGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px;margin-top:12px}
  .singleBtn{background:linear-gradient(90deg,#ff8a00,#ff3b30);border-radius:12px;padding:10px 12px;color:white;font-weight:700;border:none;cursor:pointer}
  .singleBtn.secondary{background:linear-gradient(90deg,#06b6d4,#0a84ff)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ðŸ”Ž iOS Jailbreak Quick Check â€” Advanced</h1>
      <p class="lead">Tap any action. <strong>Force Open In New Tab</strong> buttons attempt to open a custom URL scheme in a new tab/window â€” this is the strongest browser-side probe (user gesture required).</p>

      <div class="row" style="margin-top:10px">
        <span class="chip" id="deviceLabel">Detecting platformâ€¦</span>
        <span class="chip" id="uaLabel"></span>
        <span class="chip" id="envLabel"></span>
      </div>

      <div class="controls">
        <button class="btn" id="runInApp">Run In-Page Checks</button>
        <button class="btn secondary" id="openAllNewTab">Force Open All (New Tab)</button>
        <button class="btn secondary" id="clearBtn">Clear</button>
      </div>

      <div style="margin-top:12px">
        <div class="small">Individual strong probes (open in new tab):</div>
        <div class="schemeGrid" id="individualButtons">
          <!-- Individual buttons injected here -->
        </div>
      </div>

      <div class="output" id="output">
        <div class="small">Notes: In-page checks use iframes + visibility heuristics. New-tab opens use <code>window.open(..., '_blank')</code> â€” Safari may prompt or switch apps. Return to this page after each prompt to continue.</div>
      </div>

      <div id="detailArea"></div>
      <footer class="small">For reliable detection use a native app (TestFlight / AltStore) or connect to a computer.</footer>
    </div>
  </div>

<script>
(() => {
  const output = document.getElementById('output');
  const detail = document.getElementById('detailArea');
  const runBtn = document.getElementById('runInApp');
  const forceAllBtn = document.getElementById('openAllNewTab');
  const clearBtn = document.getElementById('clearBtn');
  const deviceLabel = document.getElementById('deviceLabel');
  const uaLabel = document.getElementById('uaLabel');
  const envLabel = document.getElementById('envLabel');
  const individualButtons = document.getElementById('individualButtons');

  const SCHEMES = [
    { id: 'cydia',  name:'Cydia',    scheme:'cydia://package/com.example' },
    { id: 'sileo',  name:'Sileo',    scheme:'sileo://package/com.example' },
    { id: 'zebra',  name:'Zebra',    scheme:'zbra://package/com.example' },
    { id: 'installer', name:'Installer', scheme:'installer://' }
  ];

  const ua = navigator.userAgent || '';
  const isiOS = /iPhone|iPad|iPod/i.test(ua);
  const isSafari = /Safari/.test(ua) && !/Chrome|CriOS|FxiOS/.test(ua);
  deviceLabel.textContent = isiOS ? 'Platform: iOS' : 'Platform: non-iOS';
  uaLabel.textContent = 'UA: ' + (ua.split(')')[0] || ua).slice(0, 60);
  envLabel.textContent = isSafari ? 'Browser: Safari' : 'Browser: WebView/Other';

  function log(msg, cls) {
    const d = document.createElement('div');
    d.innerHTML = msg;
    if (cls) d.className = cls;
    output.prepend(d);
  }

  function probeIframe(scheme, timeout = 1400) {
    return new Promise(resolve => {
      let handled = false;
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';

      function onVis() {
        if (document.hidden) {
          handled = true;
          cleanup();
          resolve({handled:true, reason:'visibilitychange'});
        }
      }
      function cleanup() {
        document.removeEventListener('visibilitychange', onVis);
        try { document.body.removeChild(iframe); } catch(e){}
        clearTimeout(timer);
      }
      document.addEventListener('visibilitychange', onVis);
      iframe.src = scheme;
      document.body.appendChild(iframe);
      const timer = setTimeout(()=> {
        if (!handled) {
          cleanup();
          resolve({handled:false, reason:'timeout'});
        }
      }, timeout);
    });
  }

  function openInNewTab(scheme, timeout = 1800) {
    return new Promise(resolve => {
      let newWin = null;
      let handled = false;
      const startHidden = document.hidden;

      function onVisibility() {
        if (document.hidden && !startHidden) {
          handled = true;
          cleanup();
          resolve({handled:true, reason:'visibilitychange'});
        }
      }
      function cleanup() {
        window.removeEventListener('visibilitychange', onVisibility);
        clearTimeout(timer);
        try { if (newWin && !newWin.closed) newWin.close(); } catch(e){}
      }
      window.addEventListener('visibilitychange', onVisibility);

      try {
        newWin = window.open(scheme, '_blank');
      } catch (e) {
        // popup blocked
      }

      const timer = setTimeout(()=> {
        if (!handled) {
          cleanup();
          resolve({handled:false, reason:'timeout'});
        }
      }, timeout);
    });
  }

  function uaHeuristics() {
    const lower = ua.toLowerCase();
    const tokens = ['substrate','cydia','palera1n','libhooker','tweaks','jailbreak'];
    return tokens.filter(t => lower.includes(t));
  }

  // Build individual buttons
  SCHEMES.forEach(s => {
    const btn = document.createElement('button');
    btn.className = 'singleBtn';
    btn.innerText = 'Force Open: ' + s.name;
    btn.title = 'Open ' + s.name + ' scheme in a new tab';
    btn.addEventListener('click', async () => {
      output.innerHTML = '';
      detail.innerHTML = '';
      if (!isiOS) {
        log('<div class="small">This action is only useful on iOS Safari.</div>');
        return;
      }
      log(`<div class="small">Opening <code>${s.scheme}</code> in a new tab â€” allow the prompt or app switch, then return here.</div>`);
      await new Promise(r => setTimeout(r, 120));
      const res = await openInNewTab(s.scheme, 2000);
      if (res.handled) {
        log(`<div class="bad"><b>${s.name}</b> likely installed (page focus changed).</div>`);
        detail.innerHTML = `<div class="card" style="margin-top:10px;padding:12px"><div class="bad"><strong>Indicator: ${s.name} detected</strong></div></div>`;
      } else {
        log(`<div class="small">${s.name}: no response (not definitive)</div>`);
        detail.innerHTML = `<div class="card" style="margin-top:10px;padding:12px"><div class="ok"><strong>No immediate indicator for ${s.name}</strong></div></div>`;
      }
    });
    individualButtons.appendChild(btn);
  });

  // Run in-page (iframe) checks
  runBtn.addEventListener('click', async () => {
    output.innerHTML = '';
    detail.innerHTML = '';
    if (!isiOS) {
      log('<div class="small">Run this on Safari on iPhone/iPad for meaningful results.</div>');
      return;
    }

    log('<b>Running in-page iframe checks (tap allowed)</b>');
    let detected = [];
    for (const s of SCHEMES) {
      log(`<div class="small">Probing <code>${s.scheme}</code> for ${s.name}â€¦</div>`);
      await new Promise(r => setTimeout(r, 120));
      const res = await probeIframe(s.scheme, 1400);
      if (res.handled) {
        log(`<div class="bad"><b>${s.name}</b> likely installed (visibility change).</div>`);
        detected.push(s.name);
      } else {
        log(`<div class="small">${s.name}: no response (not definitive)</div>`);
      }
      await new Promise(r => setTimeout(r, 160));
    }
    const uaHits = uaHeuristics();
    if (uaHits.length) log(`<div class="warn">UserAgent tokens: ${uaHits.join(', ')}</div>`);
    const score = Math.min(100, detected.length * 30 + (uaHits.length ? 10 : 0));
    const reasons = [...detected, ...(uaHits.length ? ['UserAgent tokens'] : [])];
    if (score > 0) {
      detail.innerHTML = `<div class="card" style="margin-top:10px;padding:12px"><div class="bad"><strong>Risk Score: ${score}/100</strong></div>
        <ul class="reasons">${reasons.map(r => `<li>${r}</li>`).join('')}</ul></div>`;
    } else {
      detail.innerHTML = `<div class="card" style="margin-top:10px;padding:12px"><div class="ok"><strong>Risk Score: 0/100 â€” no strong indicators found</strong></div></div>`;
    }
  });

  // Force open all schemes with new tab
  forceAllBtn.addEventListener('click', async () => {
    output.innerHTML = '';
    detail.innerHTML = '';
    if (!isiOS) {
      log('<div class="small">This action is only useful on iOS Safari.</div>');
      return;
    }
    log('<b>Attempting strong probe (opens each scheme in a new tab/window). After each prompt, return to this page to continue.</b>');
    let detected = [];
    for (const s of SCHEMES) {
      log(`<div class="small">Opening <code>${s.scheme}</code> in new tab â€” allow the prompt or app switch, then return here.</div>`);
      await new Promise(r => setTimeout(r, 120));
      const res = await openInNewTab(s.scheme, 1800);
      if (res.handled) {
        log(`<div class="bad"><b>${s.name}</b> likely installed (page focus changed).</div>`);
        detected.push(s.name);
      } else {
        log(`<div class="small">${s.name}: no response (not definitive)</div>`);
      }
      await new Promise(r => setTimeout(r, 260));
    }
    const uaHits = uaHeuristics();
    const score = Math.min(100, detected.length * 30 + (uaHits.length ? 10 : 0));
    const reasons = [...detected, ...(uaHits.length ? ['UserAgent tokens'] : [])];
    if (score > 0) {
      detail.innerHTML = `<div class="card" style="margin-top:10px;padding:12px"><div class="bad"><strong>Risk Score: ${score}/100</strong></div>
        <ul class="reasons">${reasons.map(r => `<li>${r}</li>`).join('')}</ul></div>`;
    } else {
      detail.innerHTML = `<div class="card" style="margin-top:10px;padding:12px"><div class="ok"><strong>Risk Score: 0/100 â€” no strong indicators found</strong></div></div>`;
    }
  });

  clearBtn.addEventListener('click', () => { output.innerHTML=''; detail.innerHTML=''; });

})();
</script>
</body>
</html>
